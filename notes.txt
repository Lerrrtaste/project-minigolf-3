#### TODOS


- ingame info popup (for limit reached, ingame events, errors etc)

- walls shouldnt hide water
- enforce objects only non solid, non resetting tiles (and remove when tile removed)
- Background 
- test if tiles as nodes work (for juicy effects and better collision and better tile property detection
- (fix / ) rewrite turn order to be used equally by server and client
- handle presence events (only leaves)
- fix practive mode
- end authorative matches properly (return nil in match_loop does not work)
- Final MVP export :)


#### DONE
- player move impact should be normalized and controller by server (so mouse distance till max force can be client independent)
- wait for map to (down)load before starting match
- ball to ball collisison (turned off when reached finished and before first shot)
- fixed wall collisions

- dont remove finished players from ingame panel (maybe icon prefix)
- store maps in nakama collection
- map storage node to handle downloading / loading mapfile
- Editor Tool Bar
- ball name tag
- simple match end screen
- refactor map and editor to use only id as key
- variable shot strenght
- Button Sprite (Disabled, Normal, Hovered, Clicked)
- 9 Patch Panel (InGame)
- Editor Icons (PlaceObj, RemoveObj, PlaceTile, RemoveTile)
- ball physics (vector reflection)
- BALL_IMPACT broadcast state data is not deserialized correctly yet, then:
- networked ball movement (remote pc) + synchronize at the end
- authorative turns
- consolidate bal
- FINISH_MOVE does not l spawn code
- stroke counter uiget sent reliable after sending REACHED_FINISH, is that is fixed, the win condition should work
- win condition
- fix bug if incorrect player sents finished turn 104 it should not be recognized by server
- water tiles + ball reset
- sand tiles + speed slowdown



#### Notes

Map name requirements: min 4 max 16 chars

Atm solid only solid tiles have a collision shape on tilemap (solid TILE_DATA prop does nothing)
Maybe save MapMetadata and full map tiles+objects in seperate collections (only if loading the whole map for only displaying name etc is too much)
Wall sprite verdeckt wasser, etwas niedriger?

UI Pixel Scale 400%


#### IDEAS (Alpha)

- Ball to Wall collision normal with 4 spheres / ray casts? Only if current does not work
- Match camera follows current player instead of local player
- every player gets a color
- screen border / ingame stats panel borader in current players color
- "in matchmaking" screen
- "loading map" screen
- emotes (zb kenney pack)
- One Match Scene per GameMode (Practice Match, DefaultMatch) (Match Node should only handly gamemode specific things, everything else in other nodes, that should work standalone) 
- paging for maps
- map rating (thumbs up/down) at the end
- show map rating in editor
- icon prefix for finished players in ingame panel



#### OP CODES

101 -> 110 MATCH_CONFIG (map_id:string, owner_id:string)
		sender: server

111 MATCH_CLIENT_READY
		sender: client
		note: map loaded and client is ready

102 -> 112 MATCH_START (joined_players:List presences, turn_order:List user_ids )
		sender: server
		note: implies next turn for first player in turn_order

106 -> 115 MATCH_END (scores:Dictionary key userid, value shots)


103 -> 120 NEXT_TURN (next_player:Dictionary presence)
		sender: server
		after recieving a FINISHED_TURN the next player is announced

104 -> 125 FINISHED_TURN (reached_finish:bool)
		sender: client
		after ball stopped moving (because of friction or reaching the finish)

105 -> 130 REACHED_FINISH ()
		sender: server
		if reached_finish in the FINISHED_TURN msg was true




// Ball Movement
201 BALL_IMPACT (impact_vec:Vector2 lengeth 0.0-1.0 realtive to balls max_speed (not networked nor changed yet)
		sender: client (local playercontroller)
		reciever: remote pc
		note: impact meaining local player initiated move (not collision from another player)

202 BALL_SYNC (synced_pos:Vector2 absolute new pos)
		sender client (local playercontroller)
		reciever: remote pc