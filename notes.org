#+title: Project Minigolf (3)
#+description: GDD and Project/Todo Management

* Game Design

* Ideas

* Tasks
** Playforio Map Converter
*** Tile Indicies
Tile code:   (isSpecial << 24) | (shapeIndex << 16) | (backgroundElementIndex << 8) | foregroundElementIndex;

Meaning:
    /**
    int isNoSpecial = tileCode / 16777216;
    int shapeIndex = tileCode / 65536 % 256; // Becomes the SpecialIndex if isNoSpecial==2
    int foregroundElementIndex = tileCode / 256 % 256;
    int backgroundElementIndex = tileCode % 256;

    * element index's
    * 0=grass, 1=dirt, 2=mud, 3=ice, 4=speed-n, 5=speed-ne,  6=speed-e, 7=speed-se
    * 8=speed-s, 9=speed-sw,  10=speed-w, 11=speed-nw
    * 12=water, 13=piss, 14=grass+water, 15=grass+piss, 16=block, 17=sticky-block
    * 18=bouncy-block,  19=hackblock?!? 20=solid-n, 21=solid-e 22=solid-s 23=solid-w
    *
    *
    * special index's
    * 0=blank, 1=hole, 2=hole, 3=moveable-block, 4=mine, 5=blowmine, 6=BIGmine, 7=blownmine2
    * 8=blue-T-source, 9= blue-T-destination, 10=red-T-source, 11= red-T-destination,
    * 12=yellow-T-source, 13= yellow-T-destination, 14=green-T-source, 15= green-T-destination,
    * 16=fullbricks, 17=threequarterbricks, 18=halfbricks, 19=quarterbricks,
    * 20=magnet-attract, 21=magnet-repel, 22=moveableblock?, 23= greenmoveableblock
    */

* Milestones
** MVP
**

* Notes


- plan Alpha
  - Update GDD
  - Categorize Ideas
  - Slice Idea count in half
  - write todo list with some project management tool



#### DONE
- Final MVP export :)

- handle presence events (only leaves)
- end authorative matches after x time when everyone left
- server starts match too early
(sends match start before client sent 111 client ready)
- THEY DONT - test if tiles as nodes work (for juicy effects and better collision and better tile property detection
- finally got tilemap / ball y sort to work,
- balls position is now faked with _get / _set
- hide balls behind walls
- Split tilemaps in ground / walls
- move pc to ball get_pos (center)
- replace map_dict object keys world pos -> cell coord
- editor respawn objects on tile change to make sure they are allowed
- scroll for editor map cards
- exit match / practice match button
- map search bar
- added practice mode button on map card 
- fix practive mode
- finish practice once before being able to publish map
- Fix Matchmaking Query/Properties:
single string_property ["map_pool"] = "1029501,102401"
query , as delimiter needs a regex expr
- main menu ui + map selection
- confirmation dialog for delete and discarding changes
- finalize match end screen
- enforce objects only non solid, non resetting tiles (and remove when tile removed)
- show editor controls somewhere
- Background 
- walls shouldnt hide water
- Main Menu UI
- editor popup close button sprite
- login screen
- set guest account metadata guest=true
- (fix / ) rewrite turn order to be used equally by server and client
- end authorative matches properly (return nil in match_loop does not work)
- ingame info popup (for limit reached, ingame events, errors etc)
- player move impact should be normalized and controller by server (so mouse distance till max force can be client independent)
- wait for map to (down)load before starting match
- ball to ball collisison (turned off when reached finished and before first shot)
- fixed wall collisions
- dont remove finished players from ingame panel (maybe icon prefix)
- store maps in nakama collection
- map storage node to handle downloading / loading mapfile
- Editor Tool Bar
- ball name tag
- simple match end screen
- refactor map and editor to use only id as key
- variable shot strenght
- Button Sprite (Disabled, Normal, Hovered, Clicked)
- 9 Patch Panel (InGame)
- Editor Icons (PlaceObj, RemoveObj, PlaceTile, RemoveTile)
- ball physics (vector reflection)
- BALL_IMPACT broadcast state data is not deserialized correctly yet, then:
- networked ball movement (remote pc) + synchronize at the end
- authorative turns
- consolidate bal
- FINISH_MOVE does not l spawn code
- stroke counter uiget sent reliable after sending REACHED_FINISH, is that is fixed, the win condition should work
- win condition
- fix bug if incorrect player sents finished turn 104 it should not be recognized by server
- water tiles + ball reset
- sand tiles + speed slowdown
- delete guest accounts occasionally (sql query in run once?)
- autotile tile übergänge ineinander

#### Notes

Map name requirements: min 4 max 16 chars

Atm solid only solid tiles have a collision shape on tilemap (solid TILE_DATA prop does nothing)
Maybe save MapMetadata and full map tiles+objects in seperate collections (only if loading the whole map for only displaying name etc is too much)
Wall sprite verdeckt wasser, etwas niedriger?

UI Pixel Scale 400%


#### IDEAS (Alpha)
- pipeline to add tiles, objects, gamemodes, events, skins, emotes
- playforia map converter (need new tiles before)
- When I use playlists etc for matchmaking, update nakama version because 3.10.0 my matchmaking query hack does not work anymore (use 3.2.1
- refresh session properly
- currently playing status on map card
- Ball to Wall collision normal with 4 spheres / ray casts? Only if current does not work
- Match camera follows current player instead of local player
- every player gets a color
- screen border / ingame stats panel borader in current players color
- "in matchmaking" screen
- "loading map" screen
- emotes (zb kenney pack) auf map / bubble über ball
- One Match Scene per GameMode (Practice Match, DefaultMatch) (Match Node should only handly gamemode specific things, everything else in other nodes, that should work standalone) 
- map rating (thumbs up/down) at the end
- show map rating in editor
- icon prefix for finished players in ingame panel
- Trees
- Balls have juicy eyes and smile when they hit each other (with sound) (emoji golf?) and the eyes roll with the ball (up+down / left+right)
- Map deltetion only a flag, remove after x days (to be able to restore maps with console access)
- itch io page (cover, banner, screenshots, html player....)
- Vote for next map
- Map playlists
- fixed maps
- "conveyor belt" tiles in all directions
- "death" tiles that reset to spawn (lava?)
- ice tiles with lower friction
- sticky walls
- bouncy walls
- "claim" guest username when logged in as guest (register)
- account / "profile" screen to change display name, mail, password etc 
- statistics on profile page (as player and as map creator)
- leaderboards per map
- menu end screen with vote up / down / report, and optional vote next, save map, map card, leaderboard, statistics
- public map "overview" window/screen with all the stats, big preview, options etc
- seperate map metadata collection <-> map tiles/objects so clients dont have to download the whole object to display map lists for example
- sound
- Map Selection: Playlists (Trending, and curated ones like Simple, Hard, Big, Small, ...) or single maps
- move remainder after collision


#### OP CODES

110 MATCH_CONFIG (map_id:string, owner_id:string, expected_user_ids:array)
		sender: server

111 MATCH_CLIENT_READY
		sender: client
		note: map loaded and client is ready

112 MATCH_START (presences:List presences, turn_order:List user_ids )
		sender: server
		note: implies next turn for first player in turn_order

115 MATCH_END (scores:Dictionary key userid, value shots)


120 NEXT_TURN (next_player:Dictionary presence)
		sender: server
		after recieving a FINISHED_TURN the next player is announced

125 TURN_COMPLETED ()
		sender: client (ball)
		after ball stopped moving (because of friction or reaching the finish)

130 REACHED_FINISH ()
		sender: server
		

150 PLAYER_LEFT (left_players:Presences list)
		sender: server
		reciever: match
		msg.sender is the leaving player


// Ball Movement
201 BALL_IMPACT (impact_vec:Vector2 lengeth 0.0-1.0 realtive to balls max_speed (not networked nor changed yet)
		sender: client (local playercontroller)
		reciever: remote pc
		note: impact meaining local player initiated move (not collision from another player)

202 BALL_SYNC (synced_pos:Vector2 absolute new pos)
		sender client (local playercontroller)
		reciever: remote pc


#### Z Layers
Tilemaps = 0
Ball = 0
PC = 10 (for line above tilemap)


#### Scrap

<- config (map+owner)
-> client ready
<- match start (joined_players, turn order) (implies next_turn)

-> finished turn (reached_finish)
<- next turn (presence (should be id))

	-> ball_impact (impact_vec)
	-> ball_sync (synced_pos)

-> finished turn (reached_finish true)
<- reached_finish (sender -> finished player)

<- match end (results)


##### Copyright/Attributions
Paulina Riva - bg placeholder pixel sky
